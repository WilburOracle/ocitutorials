---
title: "その4 - ブロック・ボリュームをインスタンスにアタッチする"
excerpt: "ストレージ容量が足りない? そんなときは、ブロック・ボリュームをネットワーク越しにインスタンスにアタッチできます。"
order: "040"
header:
  teaser: "/beginners/attaching-block-volume/img6.png"
  overlay_image: "/beginners/attaching-block-volume/img6.png"
  overlay_filter: rgba(34, 66, 55, 0.7)
#link: https://community.oracle.com/tech/welcome/discussion/4474259/
---



**チュートリアル一覧に戻る :** [Oracle Cloud Infrastructure チュートリアル](../..)

Oracle Cloud Infrastructure ブロック・ボリューム・サービスを利用することにより、ベアメタル・インスタンスや仮想マシン・インスタンスからブロックデバイスとして利用することができるボリュームを、簡単に作成、管理することができます。用途に応じたサイズのボリュームを作成、インスタンスへのアタッチ、変更などが可能です。インスタンスからボリュームに対するアクセスは iSCSI もしくは準仮想化を通じて行われます。
インスタンスにアタッチしたボリュームは、通常のディスク・ドライブと同じようにOSから利用することができ、またインスタンスからデタッチし、新しい別のインスタンスにアタッチすることで、データを失うことなく移行することが可能です。

ブロック・ボリュームの典型的なユースケースとしては以下のようなものがあります。

- インスタンスのストレージの拡張 : Oracle Cloud Infrastructure の ベアメタル・インスタンス、仮想マシン・インスタンスいずれに対しても、ブロック・ボリュームをアタッチすることでOSのストレージ領域を拡張することができます。
- 永続化されたストレージ領域の利用 : インスタンスを終了(Terminate)しても、ブロック・ボリュームとそこに格納されたデータは永続します。これらはボリュームを明示的に終了(Terminate)するまで存続します。
- インスタンス間のデータの移動 : インスタンスにアタッチしたブロック・ボリュームをデタッチし、別のインスタンスにアタッチすることにより、1つのインスタンスから別のインスタンスにデータを簡単に移動させることができます。
このチュートリアルでは、ブロック・ボリュームの基本的な使い方をご案内します。

ブロック・ボリュームのバックアップについては応用編の[ブロック・ボリュームをバックアップする](http://ocitutorials/intermediates/taking-block-volume-backups/) をどうぞ。

**所要時間 :** 約20分

**前提条件 :**

- [その2 - クラウドに仮想ネットワーク(VCN)を作る](../creating-vcn) と[その3 - インスタンスを作成する](../creating-compute-instance) を完了し、仮想クラウド・ネットワーク(VCN)の中に任意のLinuxインスタンスの作成が完了していること

**注意 :** チュートリアル内の画面ショットについては Oracle Cloud Infrastructure の現在のコンソール画面と異なっている場合があります

**目次：**

* [1. ブロック・ボリュームの作成](#anchor1)
* [2. ボリュームのインスタンスへのアタッチ](#anchor2)
* [3. ボリュームのフォーマットおよびマウント](#anchor3)


<a id="anchor1"></a>

# 1. ブロック・ボリュームの作成

1. コンソールメニューから **ブロック・ストレージ** → **ブロック・ボリューム** を選択し、**ブロック・ボリュームの作成** ボタンを押します。

2. 立ち上がった **ブロック・ボリュームの作成** ウィンドウに以下の項目を入力し、**ブロック・ボリュームの作成** ボタンを押します。
   - **名前** - 任意 (集合ハンズオン研修の場合は、講師の指示に従ってください)
   - **コンパートメントに作成** - デフォルトで現在のコンパートメントが選択されています。もし別のコンパートメントに作成したい場合は選択します。
   - **可用性ドメイン** - - 第3章でインスタンスを作成したものと同じアベイラビリティ・ドメインを選択。   
   
   > **POINT**
     >
     > ブロック・ボリュームは同じ可用性ドメイン(AD)にあるインスタンスからのみアクセスが可能です。別の可用性ドメインや、別のリージョンのインスタンスからアクセスすることはできません。

   - **サイズ(GB)** - 50 を入力
   - **バックアップ・ポリシー** - ここでは空欄のまま。（必要に応じてポリシーを選択することで自動的にバックアップ取得することも可能です）
   - **ボリューム・パフォーマンス** - ここではデフォルトの*バランス*を選択します。
   - **暗号化** - *ORACLE管理キーを使用した暗号化* が選択されていることを確認
  
     ![img1.png](img1.png)
  
3. ボリュームの作成中は プロビジョニング中 と表示されます。

     ![img2.png](img2.png)
 
4. ボリュームの作成が完了し、ステータスが 使用可能 になったことを確認します。
 
     ![img3.png](img3.png)
 


<a id="anchor2"></a>

# 2. ボリュームのインスタンスへのアタッチ

第3章で作成した仮想マシンに、先ほど作成したブロック・ボリュームをアタッチします。

アタッチ方法はiSCSIと準仮想化が選べますが、ここではiSCSIでのアタッチを行い、iSCSIコマンドを利用してOSからアクセスできるようにします。どちらを選択するかは以下を参考にしてください。

- 準仮想化 - OSからのコマンド操作は不要なので利用は簡単。IO性能のオーバーヘッドが数パーセントある。IOPSのSLAは適用されない。
- iSCSI - OSから利用するためのコマンド操作が必要。性能のオーバーヘッドはない。IOPSのSLAが適用される。
 
1. コンソールメニューから **コンピュート** → **インスタンス** を選択します。

2. 第2章で作成したインスタンスの名称のリンク 下記の例では **TestVM1** をクリックし、インスタンスの詳細画面にナビゲートします。
   
     ![img4.png](img4.png)

3. 画面下部の **リソース** から **アタッチされたブロック・ボリューム** を選択し、**ブロック・ボリュームのアタッチ** ボタンを押します。
     ![img5.png](img5.png)

4. 立ち上がった **ブロック・ボリュームのアタッチ** ウィンドウに以下の項目を入力し、**アタッチ** ボタンを押します。
   - **ブロックボリュームのアタッチ方法を選択します** - *iSCSI* を選択
   - **アクセス** - *読取り/書込み* を選択
   - **ブロック・ボリューム・コンパートメント**  - デフォルトで現在のコンパートメントが選択されています。もし別のコンパートメントに作成したボリュームをアタッチする場合は選択します。
   - **ブロック・ボリューム** - 先ほど作成したブロック・ボリュームを選択します
   - **デバイス・パス** - 任意のパスを選択します
   
     ![img6.png](img6.png)

5. iSCSIタイプを選択した場合、**ブロック・ボリュームのアタッチ** のウィンドウが開きます。内容を確認したらウィンドウを閉じます。
   
     ![img7.png](img7.png)

6. アタッチ中は、ステータスが **アタッチ中** と表示されます。

     ![img8.png](img8.png)

7. アタッチが完了すると、ステータスが **アタッチ済** に変わります。

     ![img9.png](img9.png)

8. アタッチされたボリュームの右側の **・・・** メニューから **iSCSIコマンドおよび情報** を選択します。
   
     ![img10.png](img10.png)

9. 立ち上がった **iSCSIコマンドおよび情報** ウィンドウの中に、インスタンスから iSCSI デバイスにアクセスするためのコマンドをコピーします。
   **アタッチ・コマンド** というコマンドブロックの左下にある コピー リンクをクリックし、表示が **コピー済** となったことを確認します。
   
     ![img11.png](img11.png)

10. インスタンスに opcユーザーで sshアクセスし、先ほどコピーしたコマンドをペーストして実行します。
   
     ![img12.png](img12.png)

   実行結果が **successful** となっていることを確認します。

11. 以下のコマンドを実行し、OSから新しくブロックデバイスが認識されていることを確認します。
   
     >
     > lsblk　　
     
     ![img13.png](img13.png)

    上記の例では、新しく /dev/sdb という50GBのボリュームが認識されています。

実行した iSCSI コマンドによって、インスタンスを再ブートした後も、iSCSI ボリュームに再度ログインされます。

コマンドは再起動の度に実行する必要はありません。



<a id="anchor3"></a>

# 3. ボリュームのフォーマットおよびマウント

その後、実際にボリューム上にデータを配置する際には、各OS上で適切なファイルシステムを構築して利用してください。



**目次に戻る :** [チュートリアル : Oracle Cloud Infrastructure を使ってみよう](https://oracle-japan.github.io/ocitutorials/)