---
title: "ADBにデータをアップロードしてみよう"
excerpt: "Database Actionsを利用して作成したADBにデータをロードしてみましょう。手元のPCにあるデータとオブジェクトストレージ上のデータをロードする手順を学習します。"
order: "012"
layout: single
header:
  teaser: "/database/adb102-dataload/adb2-1_1.png"
  overlay_image: "/database/adb102-dataload/adb2-1_1.png"
  overlay_filter: rgba(34, 66, 55, 0.7)
#link: https://community.oracle.com/tech/welcome/discussion/4474261/
---

この章ではSQL Developer Webの後継機能である、Database Actionsを利用して、サンプルデータをADBインスタンスにデータをアップロードします。  
事前に前提条件にリンクされているサンプルデータのCSVファイルをお手元のPC上にダウンロードください。  
（集合ハンズオンセミナーでは講師の指示に従ってください）

**前提条件 :**  
+ [ADBインスタンスを作成しよう](https://oracle-japan.github.io/ocitutorials/database/adb101-provisioning/)を完了していること  
+ 以下にリンクされているサンプルデータのCSVファイルをダウンロードしていること
<!--	+ [サンプルデータファイルのダウンロードリンク](https://github.com/oracle-japan/ocitutorials/raw/master/tutorials/_database/adb12-dataload/adb-hol2_sampledata.zip) -->
	+ [サンプルデータファイルのダウンロードリンク](/ocitutorials/database/adb102-dataload/sales_channels.csv)
	

**注意 :** チュートリアル内の画面ショットについては現在の画面と異なっている場合があります。

# 1.手元のPCからCSVデータをアップロードしてみよう

まず手元のPC上のデータをADBインスタンスにアップロードしてみましょう。サンプルデータとしてsales_channels.csvファイルを利用します。

1. [ADBインスタンスを作成しよう](https://oracle-japan.github.io/ocitutorials/database/adb101-provisioning/)で学習した**Database Actionsを利用したインスタンスへの接続** を参照し、Database Actionsを起動し、Adminユーザーで接続してください。**ツール**タブから、**データベース・アクションを開く**をクリックしてください。
   ![画面ショット1-1](img0.png)
	
1. Database Actionsのランディングページのデータ・ツールから　**データ・ロード** を選択します。

   ![画面ショット1-1](img1.png)


1. データの処理には、**データのロード** を選択し、データの場所には、**ローカル・ファイル** を選択して **次** をクリックします。

	![画面ショット1-1](img2.png)

1.  **ファイルの選択**をクリックし、ダウンロードして解凍した **sales_channels.csv** を選択します。

	![画面ショット1-1](img3.png)

1. sales_channels.csvがロードできる状態になりました。ロード前に**ペンアイコン**をクリックし、詳細設定を確認・変更できます。

	![画面ショット1-1](img4.png)

1. sales_channels.csvの表定義等のデータのプレビューを確認したら **閉じる** をクリックします。

	![画面ショット1-1](img5.png)
	
1. **緑色の実行ボタン**をクリックし、データのロードを開始します。

	![画面ショット1-1](img6.png)

1. データ・ロード・ジョブの実行を確認するポップアップが表示されるので、**実行** をクリックします。

	![画面ショット1-1](img7.png)

1. sales_channels.csvに**緑色のチェックマーク**が付き、ロードが完了しました。**完了**をクリックします。

	![画面ショット1-1](img8.png)

	> ロード完了後、*赤枠のマーク*をクリックすると、エラーログ等の詳細を見ることができます。
	![画面ショット1-1](img8.5.png)

1. ロードされたsales_channels.csvが表として格納されたのかワークシートで確認していきます。**SQL**をクリック。

	![画面ショット1-1](img9.png)

1. ロードされたデータの内容・件数を確認するために以下のSQLをワークシートに貼り付けて実行します。  
	```sql 
	select * from sales_channels; 
	```  

	結果が表示されます。  

	![画面ショット1-1](img11.png)


これで、手元のPCからデータをADBにロードするチュートリアルが完了しました。

次は、Database Actionsで、クラウド・ストレージからのデータのロードをしてみましょう。

# 2. クラウド・ストレージからのデータのロードしてみよう
この章では、オブジェクトストレージからADBへのデータロード方法を記載します。  
大量データをロードしたい場合はパフォーマンス性能の観点から本手順を推奨しています。  
サンプルデータとしてsales_channels.csvファイルを利用します。
  
作業の流れは以下の通りです。
1. OCIオブジェクトストレージへのアクセス情報を取得
1. オブジェクトストレージへのデータアップロード、アクセスURLの取得
1. Database Actionsを利用したオブジェクトストレージからのデータのロード
1. Database Actionsのワークシートからロードしたデータをクエリ

## 1.OCIオブジェクトストレージへのアクセス情報を取得
以下の手順で、ADBインスタンスからオブジェクトストレージ上のファイルにアクセスするための、ユーザ名、Auth Token（認証トークン）を取得します。  
Auth TokenはAPIでオブジェクトストレージにアクセスする時のパスワードに相当します。クレデンシャル(資格証明)を作成するときに必要な情報になります。

1. OCIサービス画面の右上にある **ユーザ（人型アイコン）→「ユーザ設定」** を選択します。  
	![画面ショット2-1](img20.jpg)

1. 画面上部に表示されている**ユーザ名**をクリップボードにコピーし、テキストファイルに保存しておきます。 次に、**認証トークンタブ**の**トークンの生成を**クリックします。
<br>
	**注意**）ユーザ名の前に **oracleidentitycloudservice/** のような接頭辞が付加されている場合は、これを含めてユーザ名とします  
	![画面ショット2-2](img21.jpg)

1. **説明**にトークンの名前(例:first_token)を入力し、**トークンの生成**をクリックします。  
	![画面ショット2-2](img22.jpg)

1. **コピー** をクリックします。生成されたトークンがクリップボードにコピーされますので、メモ帳など適切な保存場所に貼り付け保存してください。この後の手順で利用します。**閉じる**をクリックします。
>**注意** : このトークン(Token)は、作成時に一度きりしか表示されません。紛失しないように必ず安全な場所に保管してください。   
![画面ショット2-2](img23.jpg)

## 2.オブジェクトストレージへのデータアップロード
ダウンロードしたsales_channels.csvをオブジェクトストレージへアップロードします。 

1. OCIのハンバーガメニュの**ストレージ > バゲット** をクリックします。
	![画面ショット2-2](img24.jpg)

1. **バゲットの作成** をクリックします。  
  
![画面ショット2-2](img25.jpg)
	
1. **バゲット名**(例:first_backet)を入力し、**作成**をクリックします。  
	![画面ショット2-2](img26.jpg)

1. 作成したバゲットの右側のオプションから、**バゲットの詳細の表示** をクリックします。  
	![画面ショット2-2](img27.jpg)

1. **アップロード** をクリックし、sales_channels.csvをアップロードしていきましょう。
	![画面ショット2-2](img28.jpg)

1.  **ファイルを選択**をクリックし、手元のPCからsales_channels.csvを選択します。  
	![画面ショット2-2](img29.jpg)

1.  **sales_channels.csv**がアップロードされたのを確認し、**アップロード**をクリックします。
	![画面ショット2-2](img30.jpg)

1.  アップロードしたオブジェクトの右側のオプションから、**オブジェクト詳細の表示** をクリックします。  
	![画面ショット2-2](img31.jpg)

1.  *ファイル名を除いた***URLパス(URI)**をコピーし、メモ帳など適切な保存場所に貼り付け保存してください。この後の手順で利用します。**取消**をクリックして戻ります。
	**注意**）ファイル名は除いた/o/までのURLをコピーしてください。(例:https://objectstorage.us-phoenix-1.oraclecloud.com/n/myoci/b/my_bucket/o/) 
	![画面ショット2-2](img32.jpg)

## 3.Database Actionsを利用したクラウド・ストレージからのデータ・ロード

1.  Database Actionsに戻り、**データ・ロード**をクリックします。
	![画面ショット2-2](img33.jpg)

1.  データの処理には、**データのロード** を選択し、データの場所には、**クラウド・ストレージ** を選択して **次** をクリックします。
	![画面ショット2-2](img34.jpg)

1.  **+**ボタンをクリックし、クラウド・ストレージの追加を行っていきましょう。
	![画面ショット2-2](img35.jpg)

1.  **名前**には任意の名前を入力(例:*My_Cloud_Storage*)、**クラウド・ストア**には*Oracle*を選択、**URI+バケット**にはオブジェクト詳細からコピー済のURIを(例:*https://objectstorage.us-phoenix-1.oraclecloud.com/n/myoci/b/my_bucket/o/*)、クレデンシャルを作成するために**資格証明の作成**を選択して下さい。**資格証明名**には任意の名前を(例:*USER_CRED*)、**Oracle Infrastractureユーザ名**には、ユーザ設定からコピー済のユーザ名(例:*myUsername*)を、最後に認証トークン生成時にコピー済の**認証トークン**を(例:*LPB>Ktk(1M1SD+a]+r*)を入力し、**テスト**をクリックします。
	![画面ショット2-2](img36.jpg)

1.  **クラウド・ストレージURIは指定された資格証明で有効です**とテストの成功を示す表示を確認し、**作成**をクリックします。
	![画面ショット2-2](img37.jpg)

1.  **sales_channels.csv**が存在するクラウド・ストレージにアクセスできているのを確認し、画面左側の**sales_channels.csv**を画面左側へドラッグ＆ドロップします。
	![画面ショット2-2](img38.jpg)

1.  **sales_channels.csv**がデータ・ロード・ジョブに追加されたのを確認し、**緑色の実行ボタン**をクリックします。
	> 補足 すでにSALES_CHANNNEL表は作成済みのため、デフォルトだと表名が重複しないよう自動的に別名（SALES_CHANNEL_1表）で作成されロードされます。既存のSALES_CHANNEL表に追加ロードすることも可能です。 

	![画面ショット2-2](img39.jpg)

1.  データ・ロード・ジョブの実行を確認するポップアップが表示されるので、**実行** をクリックします。
	![画面ショット2-2](img40.jpg)

1.  sales_channels.csvに**緑色のチェックマーク**が付き、ロードが完了しました。**完了**をクリックします。
	![画面ショット2-2](img41.jpg)

1.  ロードされたsales_channels.csvが表として格納されたのかワークシートで確認していきます。**SQL**をクリック。
	![画面ショット2-2](img42.jpg)

1. ロードされたデータの内容・件数を確認するために以下のSQLをワークシートに貼り付けて実行します。  
	```sql 
	select * from sales_channels_1; 
	```  

	結果が表示されます。  

	![画面ショット1-1](img43.jpg)

# 3. クラウド・ストレージのデータのフィードをしてみよう

クラウド・ストレージに入ってきた新しいデータを指定した頻度でポーリングすることで、ライブ表として設定したテーブルに最新のデータを自動フィードすることができます。
従来はBucketにファイルを置いたことを定期的に監視してロードするといったスクリプトを作り込む必要がありましたが、Database Actionsのフィード機能を使えば、Bucketにファイルを置きさえすればデータベースに同期されるので、IoT用途やデータ分析に活用可能です。

1.  Database Actionsのランディングページのデータ・ツールから　**データ・ロード** を選択します。
	![画面ショット2-2](img50.png)

1.  データの処理には、**データのフィード** を選択し、データの場所には、**クラウド・ストレージ** を選択して **次** をクリックします。
	![画面ショット2-2](img51.png)

1.  **ライブ表フィードの作成**をクリックします。
	![画面ショット2-2](img52.png)

1.  **ライブ表フィード名**に任意の名前を入力(例:*LIVE_TABLE_FEED*)、**ターゲット名**に任意の名前を入力(例:*LIVE_TABLE*)、**オブジェクト・フィルタ**は正規表現の設定をする場合に入力します。**スキーマ**はドロップダウンメニューから選択(例:*ADMIN*)、**クラウド・ストレージ**はドロップダウンメニューから選択(例:*MY_CLOUD_STORAGE*)、**ポーリング**にチェックを入れることで、設定したクラウドストレージから最新のデータを取りに行く頻度を設定できます(例:*月曜日、水曜日、金曜日の2時間おき*)。また、**ポーリングの開始日と終了日**を設定することも可能です。**作成**をクリックします。
	![画面ショット2-2](img53.png)

1.  **LIVE_TABLE_FEED**というライブ表フィードが作成されました。
	![画面ショット2-2](img54.png)

1.  前述のObject Storageにcsvファイルをアップロードする項を参照しながら、Object Sorageにファイルを新規でアップロードしましょう。アップロードが終了したら、**LIVE_TABLE_FEEDの赤枠のオプションボタン**の**ライブ表フィードの即時実行(1回)**をクリックします。
	![画面ショット2-2](img55.png)

1.  新規にObject Storageにアップロードされたファイルがライブ表にフィードされたのかワークシートで確認していきます。**SQL**をクリック。
	![画面ショット2-2](img56.png)

1. ロードされたデータの内容・件数を確認するために以下のSQLをワークシートに貼り付けて実行します。  
	```sql 
	select * from LIVE_TABLE; 
	```  

	結果が表示されます。  
	![画面ショット2-2](img57.png)



以上で、この章の作業は終了です。
